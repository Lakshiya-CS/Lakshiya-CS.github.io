<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Comment Submission Form</title>
  <link rel="stylesheet" href="style/commentForm.css">
</head>
<body>
  <h1>Submit Your Comment</h1>

  <form id="commentForm" method="post">
    <!-- Contact Info -->
    <label for="name">Name:</label>
    <input id="name" type="text" name="name" required pattern="[A-Za-z\s]+" title="Letters and spaces only."><br><br>

    <label for="phone">Phone:</label>
    <input id="phone" type="tel" name="phone" required pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" placeholder="123-456-7890" title="123-456-7890"><br><br>

    <label for="email">Email:</label>
    <input id="email" type="email" name="email" required><br><br>

    <label for="comment">Comment:</label>
    <textarea id="comment" name="comment" required></textarea><br><br>

    <!-- Account Info -->
    <label for="username">Username:</label>
    <input id="username" type="text" name="username" pattern="[A-Za-z0-9_]+" required><br><br>

    <label for="password">Password:</label>
    <input id="password" type="password" name="password" minlength="8" required><br>
    <p id="passwordMessage">Password is incomplete</p><br>

    <button type="submit">Submit</button>
  </form>

  <script>
    // Password Validation
    document.getElementById("password").addEventListener("input", function() {
      let password = this.value;
      let message = document.getElementById("passwordMessage");
      const missing = [];

      if (password.length < 8) missing.push("8 characters");
      if (!/[a-z]/.test(password)) missing.push("lowercase letter");
      if (!/[A-Z]/.test(password)) missing.push("uppercase letter");
      if (!/[0-9]/.test(password)) missing.push("number");
      if (!/[!@#$%^&*()]/.test(password)) missing.push("special character");

      message.textContent = "Missing: " + missing.join(", ");
      if (missing.length === 0) message.textContent = "Strong password";
    });

    // Username Validation 
    document.getElementById("username").addEventListener("input", function() {
      let val = this.value;
      let message = document.getElementById("usernameMessage");

      if (val === "") {
        message.textContent = "Username must contain only letters, numbers, or underscores. Example: user_123";
      } 
      else if (/^[A-Za-z0-9_]+$/.test(val)) {
        message.textContent = "Valid username format.";
      } 
      else {
        message.textContent = "Error: Invalid username. Only letters, numbers, or underscores allowed. Example: user_123";
      }
    });

    // Input Sanitization Function
    function sanitize(str) {
      return str.replace(/[<>&"']/g, c => ({
        '<': '&lt;',
        '>': '&gt;',
        '&': '&amp;',
        '"': '&quot;',
        "'": '&apos;'
      }[c]));
    }

    // Form Submission
    document.getElementById("commentForm").addEventListener("submit", function(event) {
      if (!this.checkValidity()) {
        document.getElementById("result").textContent = "Please correct errors before submitting.";
        event.preventDefault();
        return;
      }

      // Sanitize all inputs
      let name = sanitize(document.getElementById("name").value.trim());
      let phone = sanitize(document.getElementById("phone").value.trim());
      let email = sanitize(document.getElementById("email").value.trim());
      let comment = sanitize(document.getElementById("comment").value.trim());
      let username = sanitize(document.getElementById("username").value.trim());
      let password = sanitize(document.getElementById("password").value.trim());

      document.getElementById("result").textContent = "Form submitted successfully! Data sanitized.";
      event.preventDefault();
    });
  </script>

  <br>
  <a href="index.html">Lakshiya's Portfolio</a>
</body>
</html>